<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini ID Data Extractor</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for the result box */
        #result-box::-webkit-scrollbar {
            width: 8px;
        }
        #result-box::-webkit-scrollbar-thumb {
            background-color: #a0aec0; /* Tailwind gray-400 */
            border-radius: 4px;
        }
        #result-box::-webkit-scrollbar-track {
            background: #2d3748; /* Tailwind gray-800 */
        }
        /* Custom font */
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-2xl bg-white dark:bg-gray-800 shadow-2xl rounded-xl p-8 space-y-8">
        <header class="text-center">
            <h1 class="text-3xl font-extrabold text-gray-900 dark:text-white mb-2">
                ID Card Data Extractor
            </h1>
            <p class="text-gray-500 dark:text-gray-400">
                Upload an image of an ID card or passport to extract structured data using the Gemini API.
            </p>
        </header>

        <!-- Upload Form -->
        <form id="uploadForm" class="space-y-6">
            <div class="relative border-2 border-dashed border-indigo-400 dark:border-indigo-600 rounded-lg p-6 hover:bg-indigo-50 dark:hover:bg-gray-700 transition-colors duration-200 cursor-pointer">
                <label for="imageFile" class="sr-only">Choose an image file to upload</label>
                <input type="file" id="imageFile" name="file" accept="image/*" required
                       title="Choose an image file to upload"
                       placeholder="Choose an image file"
                       aria-label="Choose an image file"
                       aria-describedby="fileNameSpan"
                       class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                       onchange="document.getElementById('fileNameSpan').textContent = this.files[0] ? this.files[0].name : 'No file chosen'">
                <div class="flex flex-col items-center justify-center text-indigo-600 dark:text-indigo-400">
                    <svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    <span class="font-medium text-sm">Drag & drop or <span class="text-indigo-800 dark:text-indigo-200 font-semibold">click to upload</span></span>
                    <span id="fileNameSpan" class="mt-1 text-xs text-gray-500 dark:text-gray-400">No file chosen</span>
                </div>
            </div>

            <button type="submit" id="submitButton"
                    class="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 dark:bg-indigo-700 dark:hover:bg-indigo-600 transition-colors duration-200 shadow-lg">
                <span id="buttonText">Extract Data</span>
                <svg id="loadingSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
        </form>

        <!-- Result Display -->
        <div id="statusMessage" class="text-center p-3 rounded-lg hidden text-sm font-medium"></div>

        <div class="space-y-4">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Extracted JSON Data</h3>
            <pre id="result-box" class="bg-gray-900 dark:bg-gray-900 text-green-300 p-4 rounded-lg overflow-x-auto text-sm min-h-[100px] max-h-[400px] whitespace-pre-wrap">
                <code class="language-json">Upload an image to see the structured data here.</code>
            </pre>
        </div>
    </div>

    <script>
        // NOTE: Ensure your FastAPI application is running at this base URL.
        // If running locally with default uvicorn, this should be correct.
        const API_BASE_URL = ''; 
        const API_ENDPOINT = `/extract`;

        const form = document.getElementById('uploadForm');
        const submitButton = document.getElementById('submitButton');
        const buttonText = document.getElementById('buttonText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const resultBox = document.getElementById('result-box').querySelector('code');
        const statusMessage = document.getElementById('statusMessage');

        function setStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800', 'bg-yellow-100', 'text-yellow-800');
            
            if (type === 'error') {
                statusMessage.classList.add('bg-red-100', 'text-red-800');
            } else if (type === 'success') {
                statusMessage.classList.add('bg-green-100', 'text-green-800');
            } else { // info
                statusMessage.classList.add('bg-yellow-100', 'text-yellow-800');
            }
            statusMessage.classList.remove('hidden');
        }

        function setLoading(isLoading) {
            submitButton.disabled = isLoading;
            if (isLoading) {
                loadingSpinner.classList.remove('hidden');
                buttonText.textContent = 'Processing...';
            } else {
                loadingSpinner.classList.add('hidden');
                buttonText.textContent = 'Extract Data';
            }
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            resultBox.textContent = 'Sending image to API...';
            statusMessage.classList.add('hidden');
            setLoading(true);

            const fileInput = document.getElementById('imageFile');
            const file = fileInput.files[0];

            if (!file) {
                setStatus('Please select an image file first.', 'error');
                setLoading(false);
                return;
            }

            // The FormData object correctly prepares the multipart/form-data payload
            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    body: formData,
                });

                if (response.ok) {
                    const result = await response.json();
                    resultBox.textContent = JSON.stringify(result, null, 2);
                    setStatus('Successfully extracted data!', 'success');
                } else {
                    const errorData = await response.json();
                    const detail = errorData.detail || 'Unknown server error.';
                    resultBox.textContent = `Error Status ${response.status}: ${detail}`;
                    setStatus(`Extraction failed: ${detail}`, 'error');
                }

            } catch (error) {
                console.error('Fetch error:', error);
                resultBox.textContent = 'Could not connect to the API server. Check if the backend is running.';
                setStatus('Network error: Could not reach the API.', 'error');
            } finally {
                setLoading(false);
            }
        });
    </script>
</body>
</html>
